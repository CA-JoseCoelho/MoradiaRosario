<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise Interativa de Or√ßamento - Moradia Cascais</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutrals -->
    <!-- Application Structure Plan: A multi-page simulation structure was chosen to guide the user through a linear, step-by-step analysis. It starts with a professional cover page. The main flow is: 1) Overall Totals, 2) Category Breakdown, 3) Detailed Item-by-Item Comparison, 4) Risk Summary, and 5) Interactive Optimization Simulator. This approach provides a clear, guided experience from high-level summary to granular detail. -->
    <!-- Visualization & Content Choices: Report Info: Overall cost comparison -> Goal: Compare -> Viz: Bar Chart -> Interaction: Hover for details -> Justification: Clear, immediate comparison of totals -> Library: Chart.js. Report Info: Category cost breakdown -> Goal: Compare entities across categories -> Viz: Grouped Bar Chart -> Interaction: Hover -> Justification: Detailed comparison of main work categories -> Library: Chart.js. Report Info: Item-by-item budget -> Goal: Detailed forensic comparison -> Viz: Interactive Table -> Interaction: Scroll/View -> Justification: Provides maximum detail for expert analysis -> Library: Custom JS/HTML. Report Info: Cost optimization plan -> Goal: Explore and simulate outcomes -> Viz: Interactive checklist + dynamic progress bar -> Interaction: User toggles cost-saving measures -> Justification: Engages the user in strategic decision-making -> Library: Custom JS. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdfbf8;
            color: #3f3c3a;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            height: 450px;
            max-height: 60vh;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 400px;
                max-height: 70vh;
            }
        }
        .nav-link {
            transition: color 0.3s, border-bottom-color 0.3s;
        }
        .nav-link:hover, .nav-link.active {
            color: #c88a55;
            border-bottom-color: #c88a55;
        }
        .card {
            background-color: #ffffff;
            border: 1px solid #f0e9e4;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .btn {
            background-color: #a4764e;
            color: #ffffff;
            transition: background-color 0.3s, opacity 0.3s;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
        }
        .btn:hover {
            background-color: #8c6340;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-secondary {
             background-color: #e5e7eb;
             color: #3f3c3a;
        }
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .sticky-header {
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(10px);
            background-color: rgba(253, 251, 248, 0.8);
        }
        details > summary {
            list-style: none;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details summary .arrow {
            transition: transform 0.2s;
        }
        details[open] summary .arrow {
            transform: rotate(90deg);
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .table-responsive {
            max-height: 70vh;
            overflow-y: auto;
        }
    </style>
</head>
<body class="antialiased">

    <section id="cover" class="page active flex flex-col h-screen text-center justify-between p-8 bg-white">
        <div class="flex-grow flex flex-col items-center justify-center">
            <h2 class="text-2xl md:text-3xl font-semibold text-gray-700">An√°lise Comparativa de Or√ßamentos</h2>
            <h1 class="text-3xl md:text-5xl font-bold text-[#a4764e] mt-4">Moradia Av. Nossa Sr¬™ do Ros√°rio, n¬∫ 1274 ‚Äì Cascais</h1>
            <div class="mt-10 text-lg text-gray-600">
                <p><span class="font-semibold">Cliente:</span> Dr. Nuno Pinto Ferreira</p>
            </div>
            <button id="start-analysis-btn" class="btn mt-12 text-lg px-8 py-3">Analisar</button>
        </div>
        <div class="text-center pb-4">
            <p class="text-lg font-semibold text-gray-700">CONTACTOATLANTICO</p>
            <p class="text-sm text-gray-500">2025</p>
        </div>
    </section>

    <div id="main-content" class="hidden">
        <header class="sticky-header shadow-sm">
            <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
                <h1 class="text-xl md:text-2xl font-bold text-[#a4764e]">An√°lise de Or√ßamento</h1>
                <div class="hidden md:flex space-x-8">
                    <a href="#" data-page="1" class="nav-link text-gray-600 border-b-2 border-transparent pb-1">Vis√£o Geral</a>
                    <a href="#" data-page="2" class="nav-link text-gray-600 border-b-2 border-transparent pb-1">An√°lise por Categoria</a>
                    <a href="#" data-page="3" class="nav-link text-gray-600 border-b-2 border-transparent pb-1">Comparativo Detalhado</a>
                    <a href="#" data-page="4" class="nav-link text-gray-600 border-b-2 border-transparent pb-1">Riscos</a>
                    <a href="#" data-page="5" class="nav-link text-gray-600 border-b-2 border-transparent pb-1">Estrat√©gia</a>
                </div>
            </nav>
        </header>

        <main class="container mx-auto p-4 md:p-8">
            <section id="overview" class="page text-center mb-16 pt-16">
                <h2 class="text-3xl md:text-4xl font-bold mb-2">Comparativo de Or√ßamentos</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto mb-8">An√°lise de todas as propostas, incluindo as revis√µes da FCK que demonstram um esfor√ßo de otimiza√ß√£o de custos.</p>
                <div class="grid grid-cols-2 lg:grid-cols-3 gap-6 max-w-7xl mx-auto mb-12">
                    <div class="card p-4 rounded-xl text-center">
                        <h3 class="text-md font-semibold text-gray-500">FCK (Original)</h3>
                        <p class="text-3xl font-bold text-[#a4764e] mt-2">1.396.659 ‚Ç¨</p>
                    </div>
                     <div class="card p-4 rounded-xl text-center">
                        <h3 class="text-md font-semibold text-gray-500">FCK (Rev2)</h3>
                        <p class="text-3xl font-bold text-[#b99876] mt-2">1.074.686 ‚Ç¨</p>
                    </div>
                     <div class="card p-4 rounded-xl text-center border-2 border-orange-500">
                        <h3 class="text-md font-semibold text-gray-500">FCK (Rev3)</h3>
                        <p class="text-3xl font-bold text-orange-600 mt-2">1.003.450 ‚Ç¨</p>
                    </div>
                    <div class="card p-4 rounded-xl text-center">
                        <h3 class="text-md font-semibold text-gray-500">HOTURB (Original)</h3>
                        <p class="text-3xl font-bold text-[#c88a55] mt-2">1.308.643 ‚Ç¨</p>
                    </div>
                     <div class="card p-4 rounded-xl text-center border-2 border-green-500">
                        <h3 class="text-md font-semibold text-gray-500">HOTURB (Rev1)</h3>
                        <p class="text-3xl font-bold text-green-600 mt-2">846.412 ‚Ç¨</p>
                    </div>
                    <div class="card p-4 rounded-xl text-center">
                        <h3 class="text-md font-semibold text-gray-500">Valor Mercado</h3>
                        <p class="text-3xl font-bold text-[#3f3c3a] mt-2">1.274.500 ‚Ç¨</p>
                    </div>
                </div>
                <div class="card p-4 sm:p-6 rounded-xl">
                    <div class="chart-container">
                        <canvas id="totalComparisonChart"></canvas>
                    </div>
                </div>
                 <p class="text-xs text-gray-500 mt-4">*Proposta original HOTURB incompleta. **Proposta Rev1 HOTURB com √¢mbito reduzido.</p>
            </section>

            <section id="analysis" class="page mb-16 pt-16">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">An√°lise por Categoria</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto text-center mb-12">As revis√µes da FCK mostram redu√ß√µes nos custos de Arquitetura e AVAC, enquanto a HOTURB Rev1 elimina quase por completo estes cap√≠tulos.</p>
                <div class="card p-4 sm:p-6 rounded-xl">
                    <div class="chart-container h-[500px] max-h-[70vh]">
                        <canvas id="categoryComparisonChart"></canvas>
                    </div>
                </div>
                 <div class="text-center mt-8">
                    <button id="goto-detailed-btn" class="btn">Ver Comparativo Artigo a Artigo</button>
                </div>
            </section>
            
            <section id="detailed-comparison" class="page mb-16 pt-16">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">Comparativo Detalhado Artigo a Artigo</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto text-center mb-12">Tabela comparativa de todos os artigos de cada proposta. Use a barra de scroll vertical para navegar pela tabela completa.</p>
                <div class="card rounded-xl p-2 sm:p-4">
                    <div class="table-responsive">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-100 sticky top-0">
                                <tr>
                                    <th scope="col" class="px-4 py-3 min-w-[250px]">Artigo</th>
                                    <th scope="col" class="px-4 py-3 text-right">FCK (Orig.)</th>
                                    <th scope="col" class="px-4 py-3 text-right">HOTURB (Orig.)</th>
                                    <th scope="col" class="px-4 py-3 text-right text-green-600 font-bold">HOTURB (Rev1)</th>
                                    <th scope="col" class="px-4 py-3 text-right">FCK (Rev2)</th>
                                    <th scope="col" class="px-4 py-3 text-right text-orange-600 font-bold">FCK (Rev3)</th>
                                </tr>
                            </thead>
                            <tbody id="detailed-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="risks" class="page mb-16 pt-16">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">Avalia√ß√£o de Risco</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto text-center mb-12">A proposta HOTURB Rev1, apesar do pre√ßo baixo, acarreta riscos significativos de custos futuros e qualidade. As revis√µes da FCK s√£o mais equilibradas.</p>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="card p-6 rounded-xl">
                        <div class="text-3xl mb-3">üëª</div>
                        <h3 class="font-bold text-xl mb-2">Custos Ocultos (HOTURB)</h3>
                        <p class="text-gray-600">Custos de AVAC e piscina ter√£o de ser suportados pelo cliente √† parte, ultrapassando o valor da FCK Rev3.</p>
                        <div class="mt-4 font-semibold text-red-600">Risco: Cr√≠tico</div>
                    </div>
                    <div class="card p-6 rounded-xl">
                        <div class="text-3xl mb-3">üìâ</div>
                        <h3 class="font-bold text-xl mb-2">Qualidade Incerta (HOTURB)</h3>
                        <p class="text-gray-600">A redu√ß√£o massiva em arquitetura levanta s√©rias quest√µes sobre a qualidade dos materiais a aplicar.</p>
                         <div class="mt-4 font-semibold text-red-600">Risco: Elevado</div>
                    </div>
                    <div class="card p-6 rounded-xl">
                        <div class="text-3xl mb-3">üß©</div>
                        <h3 class="font-bold text-xl mb-2">Gest√£o Fragmentada (HOTURB)</h3>
                        <p class="text-gray-600">O cliente ter√° de gerir a contrata√ß√£o de outras empresas para o AVAC e piscina, aumentando a complexidade.</p>
                        <div class="mt-4 font-semibold text-yellow-600">Risco: Elevado</div>
                    </div>
                     <div class="card p-6 rounded-xl">
                        <div class="text-3xl mb-3">‚öñÔ∏è</div>
                        <h3 class="font-bold text-xl mb-2">Proposta Equilibrada (FCK)</h3>
                        <p class="text-gray-600">As revis√µes da FCK (especialmente a Rev3) representam a melhor base para negocia√ß√£o, otimizando custos sem eliminar √¢mbito.</p>
                        <div class="mt-4 font-semibold text-green-600">Vantagem: FCK Rev3</div>
                    </div>
                </div>
            </section>

            <section id="strategy" class="page pt-16">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-4">Estrat√©gia e Otimiza√ß√£o de Custos</h2>
                <p class="text-lg text-gray-600 max-w-3xl mx-auto text-center mb-12">A recomenda√ß√£o √© usar a proposta FCK Rev3 como base de negocia√ß√£o. O simulador abaixo permite explorar otimiza√ß√µes adicionais para atingir o valor alvo de 800.000‚Ç¨.</p>
                <div class="card p-6 md:p-8 rounded-xl">
                    <h3 class="text-2xl font-bold mb-6 text-center">Simulador de Otimiza√ß√£o (Base FCK Original)</h3>
                    <p class="text-center text-gray-600 mb-8">Partindo do or√ßamento completo da FCK, selecione as a√ß√µes de otimiza√ß√£o para ver como √© poss√≠vel atingir o valor alvo sem sacrificar componentes essenciais.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                        <div class="space-y-2 max-h-[60vh] overflow-y-auto pr-2">
                            <div id="optimization-options" class="space-y-2">
                            </div>
                        </div>
                        <div class="text-center p-6 bg-[#fdfbf8] rounded-lg border border-dashed border-gray-300 sticky top-24">
                            <h4 class="text-lg font-semibold text-gray-500">Custo Total Revisto</h4>
                            <p id="optimized-total" class="text-5xl font-bold my-4 text-[#a4764e]">1.396.659 ‚Ç¨</p>
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div id="progress-bar" class="bg-green-500 h-4 rounded-full transition-all duration-500" style="width: 0%;"></div>
                            </div>
                            <div class="flex justify-between text-sm font-semibold mt-2">
                                <span id="reduction-amount" class="text-gray-600">Redu√ß√£o: 0 ‚Ç¨</span>
                                <span class="text-gray-600">Alvo: 800.000 ‚Ç¨</span>
                            </div>
                            <p id="target-message" class="mt-4 font-semibold text-lg"></p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <footer id="navigation-footer" class="hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4">
        <div class="container mx-auto flex justify-between items-center">
            <button id="prev-btn" class="btn btn-secondary">Retroceder</button>
            <div id="page-indicator" class="text-sm text-gray-500"></div>
            <button id="next-btn" class="btn">Seguinte</button>
        </div>
    </footer>

    <script>
        const NA = null; 

        const budgetData = {
            totals: {
                fck_orig: 1396658.67,
                hoturb_orig: 1308643.23,
                hoturb_rev1: 846412.12,
                fck_rev2: 1074685.26,
                fck_rev3: 1003449.88,
                market: 1274500.00,
            },
            categories: {
                labels: ["Encargos", "Arquitetura", "Estruturas", "AVAC", "El√©tricas", "√Åguas", "Paisagismo", "Piscinas"],
                fck_orig: [203190, 707113, 46111, 214751, 100480, 18576, 59190, 42663],
                hoturb_orig: [250835, 612001, 49774, 146306, 82243, 27703, 53732, 71755],
                hoturb_rev1: [252515, 464177, 11776, 17342, 33338, 27657, 39607, 0],
                fck_rev2: [156341, 563450, 46111, 120531, 80480, 18576, 59190, 42663],
                fck_rev3: [145321, 510254, 46111, 115531, 78480, 18576, 59190, 42663],
            },
            detailedComparison: [
                 {
                    chapter: "Encargos Gerais",
                    items: [
                        { desc: "Custos de estaleiro, t√©cnicos e licenciamento", fck_orig: 203190, hoturb_orig: 250835, hoturb_rev1: 246981, fck_rev2: 156341, fck_rev3: 145321 },
                        { desc: "Erros e Omiss√µes", fck_orig: NA, hoturb_orig: NA, hoturb_rev1: 5533, fck_rev2: NA, fck_rev3: NA }
                    ]
                },
                {
                    chapter: "Arquitetura",
                    items: [
                        { desc: "Alvenarias de tijolo", fck_orig: 50504, hoturb_orig: 19220, hoturb_rev1: 19220, fck_rev2: 45504, fck_rev3: 42504 },
                        { desc: "Revestimentos interiores (rebocos, estuques)", fck_orig: 62300, hoturb_orig: 55000, hoturb_rev1: 43410, fck_rev2: 58300, fck_rev3: 55300 },
                        { desc: "Tetos falsos em gesso cartonado", fck_orig: 51200, hoturb_orig: 48000, hoturb_rev1: 41030, fck_rev2: 41200, fck_rev3: 38200 },
                        { desc: "Caixilharia de Alum√≠nio/PVC", fck_orig: 142312, hoturb_orig: 90221, hoturb_rev1: 75221, fck_rev2: 95312, fck_rev3: 82312 },
                        { desc: "Carpintarias (portas, roupeiros lacados)", fck_orig: 75211, hoturb_orig: 51550, hoturb_rev1: 42550, fck_rev2: 60211, fck_rev3: 55211 },
                        { desc: "M√≥veis de cozinha e bancada", fck_orig: 48766, hoturb_orig: 41695, hoturb_rev1: 29880, fck_rev2: 38766, fck_rev3: 32766 },
                        { desc: "Equipamentos e lou√ßas sanit√°rias", fck_orig: 55000, hoturb_orig: 45000, hoturb_rev1: 25000, fck_rev2: 45000, fck_rev3: 40000 },
                        { desc: "Pinturas interiores e exteriores", fck_orig: 60000, hoturb_orig: 50000, hoturb_rev1: 40000, fck_rev2: 50000, fck_rev3: 45000 },
                        { desc: "Lareira com recuperador de calor", fck_orig: 8540, hoturb_orig: 6500, hoturb_rev1: 0, fck_rev2: 8540, fck_rev3: 0 }
                    ]
                },
                {
                    chapter: "Instala√ß√µes de Climatiza√ß√£o e Ventila√ß√£o (AVAC)",
                    items: [
                        { desc: "Pr√©-instala√ß√£o de Ar Condicionado", fck_orig: 15000, hoturb_orig: 15000, hoturb_rev1: 17342, fck_rev2: 15000, fck_rev3: 15000 },
                        { desc: "Unidades interiores e exteriores de AC", fck_orig: 29861, hoturb_orig: 0, hoturb_rev1: 0, fck_rev2: 29861, fck_rev3: 29861 },
                        { desc: "Sistema de Ventila√ß√£o Mec√¢nica (VMC)", fck_orig: 17518, hoturb_orig: 0, hoturb_rev1: 0, fck_rev2: 17518, fck_rev3: 0 },
                        { desc: "Pavimento radiante hidr√°ulico", fck_orig: 37344, hoturb_orig: 35000, hoturb_rev1: 0, fck_rev2: 0, fck_rev3: 0 },
                        { desc: "Bomba de calor para AQS e climatiza√ß√£o", fck_orig: 25000, hoturb_orig: 20000, hoturb_rev1: 0, fck_rev2: 25000, fck_rev3: 25000 },
                        { desc: "Pain√©is solares (AQS + Fotovoltaico)", fck_orig: 30000, hoturb_orig: 20000, hoturb_rev1: 0, fck_rev2: 30000, fck_rev3: 28000 },
                    ]
                },
                {
                    chapter: "Piscina",
                    items: [
                        { desc: "Constru√ß√£o de Piscina (estrutura, acabamento)", fck_orig: 32663, hoturb_orig: 55000, hoturb_rev1: 0, fck_rev2: 32663, fck_rev3: 32663 },
                        { desc: "Equipamentos de filtra√ß√£o e tratamento", fck_orig: 10000, hoturb_orig: 16755, hoturb_rev1: 0, fck_rev2: 10000, fck_rev3: 10000 }
                    ]
                }
            ],
            optimization: [
                {
                    category: "Arquitetura (-278.540 ‚Ç¨)",
                    items: [
                        { label: "Substituir caixilharia de alum√≠nio por PVC de gama alta", reduction: 60000.00 },
                        { label: "Substituir revestimento exterior 'capoto' por reboco pintado", reduction: 20000.00 },
                        { label: "Alterar carpintarias lacadas para melamina/termolaminado", reduction: 35000.00 },
                        { label: "Simplificar m√≥veis de cozinha e bancada", reduction: 25000.00 },
                        { label: "Eliminar Lareira com recuperador de calor", reduction: 8540.00 },
                    ]
                },
                {
                    category: "AVAC e Energia (-96.972 ‚Ç¨)",
                    items: [
                        { label: "Eliminar pavimento radiante hidr√°ulico", reduction: 37344.48 },
                        { label: "Eliminar Sistema de Ventila√ß√£o VMC", reduction: 17517.72 },
                        { label: "Eliminar Ar Condicionado (manter apenas pr√©-instala√ß√£o)", reduction: 29860.56 },
                    ]
                },
                {
                    category: "Instala√ß√µes El√©tricas e Dom√≥tica (-68.500 ‚Ç¨)",
                    items: [
                        { label: "Eliminar Sistema de Dom√≥tica KNX", reduction: 18500.00 },
                        { label: "Otimizar projeto de ilumina√ß√£o", reduction: 25000.00 },
                    ]
                },
                {
                    category: "Piscina e Jacuzzi (-42.663 ‚Ç¨)",
                    items: [
                        { label: "Adiar constru√ß√£o da piscina (deixar pr√©-instala√ß√£o)", reduction: 32663.30 },
                    ]
                },
            ]
        };

        const formatCurrency = (value) => {
            if (value === null || value === undefined) return '‚Äî';
            if (value === 0) return 'Exclu√≠do';
            return new Intl.NumberFormat('pt-PT', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 }).format(value);
        }

        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'top' },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) { label += ': '; }
                            if (context.parsed.y !== null) { label += formatCurrency(context.parsed.y); }
                            return label;
                        }
                    }
                }
            },
            scales: {
                y: { beginAtZero: true, ticks: { callback: value => (value / 1000) + 'k ‚Ç¨' } },
            }
        };

        let charts = {};
        function initCharts() {
            if (!charts.total && document.getElementById('totalComparisonChart')) {
                const ctx = document.getElementById('totalComparisonChart').getContext('2d');
                const chartLabels = ['FCK (Orig.)', 'HOTURB (Orig.)', 'HOTURB (Rev1)', 'FCK (Rev2)', 'FCK (Rev3)', 'Mercado'];
                const chartData = [
                    budgetData.totals.fck_orig,
                    budgetData.totals.hoturb_orig,
                    budgetData.totals.hoturb_rev1,
                    budgetData.totals.fck_rev2,
                    budgetData.totals.fck_rev3,
                    budgetData.totals.market
                ];

                charts.total = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            label: 'Custo Total (‚Ç¨)',
                            data: chartData,
                            backgroundColor: ['#a4764e', '#c88a55', '#22c55e', '#b99876', '#f97316', '#3f3c3a'],
                        }]
                    },
                    options: { ...chartOptions, plugins: { legend: { display: false } } }
                });
            }
            if (!charts.category && document.getElementById('categoryComparisonChart')) {
                const ctx = document.getElementById('categoryComparisonChart').getContext('2d');
                charts.category = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: budgetData.categories.labels,
                        datasets: [
                            { label: 'FCK (Orig.)', data: budgetData.categories.fck_orig, backgroundColor: '#a4764e' },
                            { label: 'HOTURB (Orig.)', data: budgetData.categories.hoturb_orig, backgroundColor: '#c88a55' },
                            { label: 'HOTURB (Rev1)', data: budgetData.categories.hoturb_rev1, backgroundColor: '#22c55e' },
                            { label: 'FCK (Rev2)', data: budgetData.categories.fck_rev2, backgroundColor: '#b99876' },
                            { label: 'FCK (Rev3)', data: budgetData.categories.fck_rev3, backgroundColor: '#f97316' },
                        ]
                    },
                    options: chartOptions
                });
            }
        }
        
        function renderDetailedTable() {
            const tableBody = document.getElementById('detailed-table-body');
            let html = '';
            budgetData.detailedComparison.forEach(chapter => {
                html += `<tr class="bg-gray-50 border-b"><td colspan="6" class="px-4 py-3 font-bold text-base text-gray-800">${chapter.chapter}</td></tr>`;
                chapter.items.forEach(item => {
                    html += `
                        <tr class="bg-white border-b hover:bg-gray-50">
                            <td class="px-4 py-4 font-medium text-gray-900">${item.desc}</td>
                            <td class="px-4 py-4 text-right">${formatCurrency(item.fck_orig)}</td>
                            <td class="px-4 py-4 text-right">${formatCurrency(item.hoturb_orig)}</td>
                            <td class="px-4 py-4 text-right font-bold text-green-700">${formatCurrency(item.hoturb_rev1)}</td>
                            <td class="px-4 py-4 text-right">${formatCurrency(item.fck_rev2)}</td>
                            <td class="px-4 py-4 text-right font-bold text-orange-700">${formatCurrency(item.fck_rev3)}</td>
                        </tr>
                    `;
                });
            });
            if (tableBody) tableBody.innerHTML = html;
        }

        const optimizationContainer = document.getElementById('optimization-options');
        const initialBudget = budgetData.totals.fck_orig;
        const targetBudget = 800000;

        function setupOptimizationSimulator() {
            if (!optimizationContainer) return;
            let optIndex = 0;
            budgetData.optimization.forEach((cat) => {
                const details = document.createElement('details');
                details.className = 'border rounded-lg bg-white overflow-hidden';
                const summary = document.createElement('summary');
                summary.className = 'p-4 font-semibold cursor-pointer flex justify-between items-center bg-gray-50';
                summary.innerHTML = `<span>${cat.category}</span><span class="arrow"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg></span>`;
                details.appendChild(summary);
                const itemsContainer = document.createElement('div');
                itemsContainer.className = 'p-4 space-y-3 border-t';
                cat.items.forEach(item => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'flex items-center justify-between text-sm';
                    optionDiv.innerHTML = `<label for="opt-${optIndex}" class="flex-grow pr-4 text-gray-700">${item.label}</label><div class="flex items-center space-x-3 flex-shrink-0"><span class="font-semibold text-red-500">-${formatCurrency(item.reduction)}</span><input type="checkbox" id="opt-${optIndex}" data-reduction="${item.reduction}" class="h-5 w-5 rounded border-gray-300 text-[#a4764e] focus:ring-[#a4764e] optimization-checkbox"></div>`;
                    itemsContainer.appendChild(optionDiv);
                    optIndex++;
                });
                details.appendChild(itemsContainer);
                optimizationContainer.appendChild(details);
            });
            document.querySelectorAll('.optimization-checkbox').forEach(c => c.addEventListener('change', updateOptimization));
        }
        
        function updateOptimization() {
            const optimizedTotalEl = document.getElementById('optimized-total');
            const progressBarEl = document.getElementById('progress-bar');
            const reductionAmountEl = document.getElementById('reduction-amount');
            const targetMessageEl = document.getElementById('target-message');

            let totalReduction = 0;
            document.querySelectorAll('.optimization-checkbox:checked').forEach(box => {
                totalReduction += parseFloat(box.dataset.reduction);
            });
            let currentTotal = initialBudget - totalReduction;
            
            const totalPossibleReduction = initialBudget - targetBudget;
            const progress = totalPossibleReduction > 0 ? (totalReduction / totalPossibleReduction * 100) : 0;

            if(optimizedTotalEl) optimizedTotalEl.textContent = formatCurrency(currentTotal);
            if(reductionAmountEl) reductionAmountEl.textContent = `Redu√ß√£o: ${formatCurrency(totalReduction)}`;
            if(progressBarEl) progressBarEl.style.width = `${Math.min(progress, 100)}%`;

            if(targetMessageEl) {
                if (currentTotal <= targetBudget) {
                    targetMessageEl.textContent = 'üéâ Objetivo Atingido!';
                    targetMessageEl.className = 'mt-4 font-semibold text-lg text-green-600';
                    if(progressBarEl) progressBarEl.className = 'bg-green-500 h-4 rounded-full transition-all duration-500';
                } else {
                    targetMessageEl.textContent = `Faltam ${formatCurrency(currentTotal - targetBudget)} para o alvo.`;
                    targetMessageEl.className = 'mt-4 font-semibold text-lg text-yellow-600';
                    if(progressBarEl) progressBarEl.className = 'bg-yellow-500 h-4 rounded-full transition-all duration-500';
                }
            }
        }
        
        const mainContent = document.getElementById('main-content');
        const startAnalysisBtn = document.getElementById('start-analysis-btn');
        const pages = document.querySelectorAll('#main-content .page');
        const navLinks = document.querySelectorAll('.nav-link');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const navFooter = document.getElementById('navigation-footer');
        const pageIndicator = document.getElementById('page-indicator');
        const gotoDetailedBtn = document.getElementById('goto-detailed-btn');
        
        let currentPage = 1;
        const totalPages = pages.length;

        function showPage(index) {
            if (index < 1 || index > totalPages) return;
            currentPage = index;
            pages.forEach((page, i) => page.classList.toggle('active', (i + 1) === index));
            initCharts();
            if(prevBtn) prevBtn.disabled = currentPage === 1;
            if(nextBtn) nextBtn.disabled = currentPage === totalPages;
            if(pageIndicator) pageIndicator.textContent = `P√°gina ${currentPage} de ${totalPages}`;
            navLinks.forEach(link => link.classList.toggle('active', parseInt(link.dataset.page) === currentPage));
            window.scrollTo(0, 0);
        }
        
        if (startAnalysisBtn) {
            startAnalysisBtn.addEventListener('click', () => {
                document.getElementById('cover').classList.remove('active');
                if (mainContent) mainContent.classList.remove('hidden');
                if (navFooter) navFooter.classList.remove('hidden');
                showPage(1);
            });
        }

        if(prevBtn) prevBtn.addEventListener('click', () => showPage(currentPage - 1));
        if(nextBtn) nextBtn.addEventListener('click', () => showPage(currentPage + 1));
        if(gotoDetailedBtn) gotoDetailedBtn.addEventListener('click', () => showPage(3));
        
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(parseInt(link.dataset.page));
            });
        });
        
        document.addEventListener('DOMContentLoaded', () => {
             renderDetailedTable();
             setupOptimizationSimulator();
        });

    </script>
</body>
</html>

